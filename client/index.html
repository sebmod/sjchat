<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
	<title>Chat prototype</title>
	<script src="js/jquery-3.2.1.min.js"></script>
	<script src="js/dataManager.js"></script>
    <script src="js/react/browser.min.js"></script>
</head>
<body>
	<h1>
		SjChat
	</h1>
	<div>
		<h3>Data loaded</h3>
		<p id="datadump"> </p>
	</div>
	<script>
		var apiAddress = window.location.protocol +'//'+ window.location.hostname +':8080';
		var dataManager = new DataManager();

		$.ajaxSetup({
			async: false
 		});

		// Add chats
		$.get(apiAddress+"/chat", function(data){
			var chats = data;

			for (let chat of chats){
				dataManager.putChat(chat);

				for (let user of chat.users){
					dataManager.putUser(user);
				}
			}

		});

		// Add messages to chats
		for (var chatId in dataManager.chats){
			$.get(apiAddress+"/chat/"+chatId+"/message", function(data){
				var messages = data;

				for (let message of messages){
					dataManager.putMessage(chatId, message);
				}
			});
		}

		document.getElementById("datadump").innerHTML = JSON.stringify(dataManager, null, 2);
	</script>

	<div style="width: 30%; background-color: #FF55AA; float: left">
		<h3>Chats</h3>
	</div>

	<div style="width: 70%; background-color: #AA55FF; float: right">
		<h3>Chat: </h3>
	</div>

	
</body>
</html>