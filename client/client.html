<html>
<head>
	<title>Chat prototype</title>
	<script src="js/jquery-3.2.1.min.js"></script>
	<script src="js/dataManager.js"></script>
</head>
<body>
	<h1>
		SjChat
	</h1>
	<p id="chatExample"> </p>
	<script>
		// Change when back-end works
		var apiAddress = window.location.protocol +'//'+ window.location.hostname +':8080';
		var dataManager = new DataManager();

		$.ajaxSetup({
			async: false
 		});

		// Add chats
		$.get(apiAddress+"/chat", function(data){
			var chats = data;

			for (let chat of chats){
				dataManager.putChat(chat);

				for (let user of chat.users){
					dataManager.putUser(user);
				}
			}

		});

		// Add messages to chats
		for (var chatId in dataManager.chats){
			$.get(apiAddress+"/chat/"+chatId+"/message", function(data){
				var messages = data;

				for (let message of messages){
					dataManager.putMessage(chatId, message);
				}
			});
		}

		document.getElementById("chatExample").innerHTML = JSON.stringify(dataManager, null, 2);

	</script>
</body>
</html>